<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title> Example </title>
<script>

var startDashBoard = () => {

async function getDataFrom(url) {
	const response = await fetch(url, {
		method: 'GET',
		headers: {
		'Content-Type': 'application/json'
		}	
	});
	
	return response;
}

function getLastValuesDevice() {	
	let devId = document.getElementById("deviceIdLast").value;

	getDataFrom('https://ytm5feii9h.execute-api.us-east-1.amazonaws.com/last-values/'+devId)
	.then(response => response.json())
	.then(data => {
	data = JSON.parse(data);

		console.log(data)
		
		document.getElementById("temperature").innerHTML = data.temperature;
		document.getElementById("light").innerHTML = data.light;

		document.getElementById("led0Value").innerHTML = data.led0;
		document.getElementById("led1Value").innerHTML = data.led1;
		document.getElementById("led2Value").innerHTML = data.led2;	
	})
	.catch(error => console.log('error', error));


	setTimeout(getLastValuesDevice, 10000);
};

function getAggregateValuesDevice() {
	let devId = document.getElementById("deviceIdAgg").value;

	getDataFrom('https://ytm5feii9h.execute-api.us-east-1.amazonaws.com/aggregate-values/'+devId)
	.then(response => response.json())
	.then(data => {
	data = JSON.parse(data);
	
		var temperature = data.temperature;

		document.getElementById("temperatureDevMax").innerHTML = temperature.max;	
		document.getElementById("temperatureDevMin").innerHTML = temperature.min;
		document.getElementById("temperatureDevAvg").innerHTML = temperature.avg;
		
		var light = data.light;

		document.getElementById("lightDevMax").innerHTML = light.max;
		document.getElementById("lightDevMin").innerHTML = light.min;
		document.getElementById("lightDevAvg").innerHTML = light.avg;
	})
	.catch(error => console.log('error', error));

	setTimeout(getAggregateValuesDevice, 10000);
};

function getAggregateValues() {
	getDataFrom('https://ytm5feii9h.execute-api.us-east-1.amazonaws.com/aggregate-values')
	.then(response => response.json())
	.then(data => {
	data = JSON.parse(data);
	
		var temperature = data.temperature;

		document.getElementById("temperatureMax").innerHTML = temperature.max;	
		document.getElementById("temperatureMin").innerHTML = temperature.min;
		document.getElementById("temperatureAvg").innerHTML = temperature.avg;
		
		var light = data.light;

		document.getElementById("lightMax").innerHTML = light.max;
		document.getElementById("lightMin").innerHTML = light.min;
		document.getElementById("lightAvg").innerHTML = light.avg;
	})
	.catch(error => console.log('error', error));

	setTimeout(getAggregateValues, 10000);
};

document.getElementById("deviceIdLast").value = 1;
document.getElementById("deviceIdAgg").value = 1;

getAggregateValues();
getAggregateValuesDevice();
getLastValuesDevice();
}
</script>
</head>


<body onload=startDashBoard()>

<script>
function postDataTo(url, data) {
	const response = fetch(url, {
		method: 'POST',
		headers: {
		'Content-Type': 'application/json'
		},
	body: JSON.stringify(data)
	});
	return response;
	}

function controlActuator(newActuatorState) {
	let deviceIdVal = document.getElementById("deviceIdAct").value;
	newActuatorState["deviceId"] = deviceIdVal;
	postDataTo('https://ytm5feii9h.execute-api.us-east-1.amazonaws.com/control-actuators', newActuatorState);
}

</script>
<h2>Last values from one specific device </h2>
	<input type="number" id="deviceIdLast">
	<p> Temperature
		<span id="temperature"></span>
	</p>
	<p> Light 
		<span id="light"></span>
	</p>
	<p>
		led0 <span id="led0Value"></span>
	</p>
	<p>
		led1 <span id="led1Value"></span>
	</p>
	<p>
		led2 <span id="led2Value"></span>
	</p>
<h2> Aggregated data from one specific device</h2>
	<input type="number" id="deviceIdAgg">
	<p> Temperature
		<span id="temperatureDevMax"></span>
		<span id="temperatureDevMin"></span>
		<span id="temperatureDevAvg"></span>
	</p>
	<p> Light 
		<span id="lightDevMax"></span>
		<span id="lightDevMin"></span>
		<span id="lightDevAvg"></span>
	</p>
<h2>Aggregated data from all devices</h2>
	<p> Temperature
		<span id="temperatureMax"></span>
		<span id="temperatureMin"></span>
		<span id="temperatureAvg"></span>
	</p>
	<p> Light 
		<span id="lightMax"></span>
		<span id="lightMin"></span>
		<span id="lightAvg"></span>
	</p>
<h2> Actutators control of a specific device</h2>
	<input type="number" id="deviceIdAct">
	<input id="led0TurnOn" type="button" value="turn on" onclick="controlActuator({led0: 1})">
	<input id="led0TurnOff" type="button" value="turn off" onclick="controlActuator({led0: 0})">
	<input id="led1TurnOn" type="button" value="turn on" onclick="controlActuator({led1: 1})">
	<input id="led1TurnOff" type="button" value="turn off" onclick="controlActuator({led1: 0})">
	<input id="led2TurnOn" type="button" value="turn on" onclick="controlActuator({led2: 1})">
	<input id="led2TurnOff" type="button" value="turn off" onclick="controlActuator({led2: 0})">
</body>
</html>
